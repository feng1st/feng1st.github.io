<!DOCTYPE html>
<html lang="utf-8">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="Hugo 0.25.1" />
    <link rel="shortcut icon" href="/images/favicon.ico">
    <link href="https://feng1st.github.io/index.xml" rel="alternate" type="application/rss+xml" title="知不足而后进" />
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    
    <script src="https://apis.google.com/js/platform.js" async defer>{lang: 'ja'}</script>
    
    <link rel="stylesheet" href="https://yandex.st/highlightjs/8.0/styles/default.min.css">
    <script src="https://yandex.st/highlightjs/8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <title>Spring实现RESTful Service笔记 | 知不足而后进</title>
  </head>
  <body>
    <div id="wrap">
      
      <header class="site-header">
        <div class="site-header-left">
          <a class="site-header-title" href="https://feng1st.github.io/">知不足而后进</a>
        </div>
      </header>
      <div class="container">
        <div id="main">

<div class="article">
  <header>
    <div class="article-header">
      <h1>Spring实现RESTful Service笔记</h1>
      <div class="article-meta">
        <span class="posttime">2017/06/26</span>
        
<div class="tags">
  <ul>
    
    <li>
        <a href="/tags/spring">Spring</a>
    </li>
    
    <li>
        <a href="/tags/restful">RESTful</a>
    </li>
    
  </ul>
</div>


      </div>
    </div>
    

  </header>
  <div class="content">
    

<p>来源：
<a href="https://spring.io/guides/gs/rest-service/">https://spring.io/guides/gs/rest-service/</a></p>

<p>本文采用代码及分析的形式</p>

<h2 id="greetingcontroller-java">GreetingController.java</h2>

<p><code>src/main/java/hello/GreetingController.java</code></p>

<pre><code>package hello;

import java.util.concurrent.atomic.AtomicLong;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class GreetingController {

    private static final String template = &quot;Hello, %s!&quot;;
    private final AtomicLong counter = new AtomicLong();

    @RequestMapping(&quot;/greeting&quot;)
    public Greeting greeting(@RequestParam(value=&quot;name&quot;, defaultValue=&quot;World&quot;) String name) {
        return new Greeting(counter.incrementAndGet(),
                            String.format(template, name));
    }
}
</code></pre>

<ul>
<li><code>@RestController</code>

<ul>
<li>整合<code>@Controller</code>, <code>@ResponseBody</code></li>
<li><code>@Controller</code>

<ul>
<li>MVC里的Controller，Spring的DispatcherServlet，通过HandlerMapping，找到Controller后，将请求发送过来进行处理</li>
</ul></li>
<li><code>@ResponseBody</code>

<ul>
<li>将返回的对象，通过注册的HttpMessageConverter，转换成字符串，写入Response的body里</li>
<li>对应的是<code>@RequestBody</code>，通过Request header的Content-Type，将Request的body转换成对象</li>
</ul></li>
</ul></li>
<li><code>@RequestMapping</code>

<ul>
<li>URL到Controller类和方法的映射</li>
</ul></li>
<li><code>@RequestParam</code>

<ul>
<li>URL参数到方法参数的映射</li>
</ul></li>
</ul>

<p>RestController和一般的MVC Controller最主要的不同的地方：</p>

<ul>
<li>RestController用Response Body返回json序列化后的对象</li>
<li>MVC Controller使用视图模板，返回ModelAndView经渲染后的HTML视图</li>
</ul>

<p><img src="1353059506_5137.jpg" alt="" />
图片来源：<a href="http://blog.csdn.net/cswhale/article/details/16941281">http://blog.csdn.net/cswhale/article/details/16941281</a></p>

<h2 id="application-java">Application.java</h2>

<p><code>src/main/java/hello/Application.java</code></p>

<pre><code>package hello;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Application {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>

<ul>
<li><code>@SpringBootApplication</code>, 整合下列注解:

<ul>
<li><code>@Configuration</code>

<ul>
<li>类作为Bean定义的来源，参考<code>AnnotationConfigApplicationContext</code></li>
</ul></li>
<li><code>@EnableAutoConfiguration</code>

<ul>
<li>指示Spring Boot根据classpath、其它Bean和一些属性自动配置</li>
</ul></li>
<li><code>@EnableWebMvc</code>

<ul>
<li>如果在classpath发现<strong>spring-webmvc</strong>，自动启用</li>
<li>视应用为web application，并启用DispatcherServlet等关键行为</li>
</ul></li>
<li><code>@ComponentScan</code>

<ul>
<li>从类所在包下扫描其它组件、配置、服务，找到其它controller</li>
</ul></li>
</ul></li>
</ul>

<p>整个SpringBoot应用可以打包成一个单独的jar，这个特性非常有利于部署到容器</p>

<h2 id="依靠配置实现mvc">依靠配置实现MVC</h2>

<p>如果不使用SpringBoot，而是通过配置来实现，应该怎样做呢？
这个不是完全RESTful相关的，但有助于我们了解Spring的内部机制</p>

<p>Controller接口，注意不是@Controller注解：</p>

<pre><code>public interface Controller {
    ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception;
}
</code></pre>

<p>该方法被DispatcherServlet调用</p>

<p>重要的实现类：</p>

<ul>
<li>AbstractController：检查HTTP方法，检查Session等</li>
<li>MultiActionController：在一个Controller里处理多个动作，比如对同一资源的增删改查，通过MethodNameResolver映射请求到方法</li>
</ul>

<p><code>web.xml</code></p>

<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/j2ee&quot;
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_5.xsd&quot;
  version=&quot;2.5&quot;&gt;
&lt;servlet&gt;
     &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
     &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
     &lt;init-param&gt;
           &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
           &lt;param-value&gt;/WEB-INF/dispatcherServlet-servlet.xml&lt;/param-value&gt;
     &lt;/init-param&gt;
     &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
     &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
     &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</code></pre>

<ul>
<li>所有以.do结尾的请求，都将被DispatcherServlet处理</li>
</ul>

<p><code>dispatcherServlet-servlet.xml</code></p>

<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE beans PUBLIC &quot;-//SPRING//DTD BEAN 2.0//EN&quot;
&quot;http://www.springframework.org/dtd/spring-beans-2.0.dtd&quot;&gt;
&lt;beans&gt;
     &lt;bean id=&quot;urlMapping&quot; class=&quot;org.springframework.web.servlet.handler.SimpleUrlHandlerMapping&quot;&gt;
            &lt;property name=&quot;mappings&quot;&gt;
                 &lt;props&gt;
                       &lt;prop key=&quot;sample.do&quot;&gt;sampleMultiActionController&lt;/prop&gt;
                 &lt;/props&gt;
            &lt;/property&gt;
     &lt;/bean&gt;
     &lt;bean id=&quot;viewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
            &lt;property name=&quot;viewClass&quot;&gt;
                 &lt;value&gt;org.springframework.web.servlet.view.InternalResourceView&lt;/value&gt;
            &lt;/property&gt;
            &lt;property name=&quot;prefix&quot;&gt;
                 &lt;value&gt;/WEB-INF/jsp/&lt;/value&gt;
            &lt;/property&gt;
            &lt;property name=&quot;suffix&quot;&gt;
                 &lt;value&gt;.jsp&lt;/value&gt;
            &lt;/property&gt;
     &lt;/bean&gt;


     &lt;bean id=&quot;sampleMultiActionController&quot; class=&quot;com.test.SampleMultiActionController&quot;&gt;
           &lt;property name=&quot;methodNameResolver&quot;&gt;
                 &lt;ref bean=&quot;paraMethodResolver&quot;/&gt;
           &lt;/property&gt;
     &lt;!--viewName属性将依赖注入sampleMultiActionController类--&gt;
           &lt;property name=&quot;viewName&quot;&gt;
                 &lt;value&gt;showme&lt;/value&gt;
           &lt;/property&gt;
     &lt;/bean&gt;

     &lt;bean id=&quot;paraMethodResolver&quot; class=&quot;org.springframework.web.servlet.mvc.multiaction.ParameterMethodNameResolver&quot;&gt;
           &lt;property name=&quot;paramName&quot; value=&quot;whichMethod&quot;/&gt;
     &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>

<ul>
<li><code>sample.do</code>会被<code>SampleMultiActionController</code>处理</li>
<li><code>viewName</code>即<code>showme</code>，被依赖注入传入Controller，通过<code>return new ModelAndView(getViewName(), ...)</code>指定视图名称</li>
<li><code>viewResolver</code>解析视图为<code>/WEB-INF/jsp/showme.jsp</code></li>
<li><code>methodNameResolver</code>指定<code>ParameterMethodNameResolver</code></li>
<li><code>paraMethodResolver</code>指定的参数名为<code>whichMethod</code>，即能将<code>sample.do?whichMethod=insert</code>这样的请求，映射到<code>insert()</code>方法</li>
</ul>

  </div>
  <footer>
    <div class="article-footer">
      
<div class="tags">
  <ul>
    
    <li>
        <a href="/tags/spring">Spring</a>
    </li>
    
    <li>
        <a href="/tags/restful">RESTful</a>
    </li>
    
  </ul>
</div>


      
      

      
      
      <div id="pagenavigation-next-prev">
        
        <div id="pagenavigation-next">
          <span class="pagenav-label">Previous</span>
          <a href="https://feng1st.github.io/post/2017/06/spring-dispatcher-servlet/">Spring DispatcherServlet相关知识点</a>
        </div>
        
        
        <div id="pagenavigation-prev">
          <span class="pagenav-label">Next</span>
          <a href="https://feng1st.github.io/post/2017/06/dubbo-in-docker/">Docker容器运行dubbo应用</a>
        </div>
        
      </div>
      
    </div>
  </footer>
</div>
        </div>
        <div class="sidebar">
  
  
  
  <div class="sidebar-content">
    <div class="sidebar-header">
      <span>Categories</span>
    </div>
    <div class="categories">
      <ul>
        
        <li>
          <a href="/categories/docker"><span></span>docker (1)</a>
        </li>
        
        <li>
          <a href="/categories/java"><span></span>java (2)</a>
        </li>
        
        <li>
          <a href="/categories/network"><span></span>network (2)</a>
        </li>
        
        <li>
          <a href="/categories/services"><span></span>services (3)</a>
        </li>
        
        <li>
          <a href="/categories/servlet"><span></span>servlet (3)</a>
        </li>
        
        <li>
          <a href="/categories/spring"><span></span>spring (2)</a>
        </li>
        
        <li>
          <a href="/categories/utilities"><span></span>utilities (1)</a>
        </li>
        
      </ul>
    </div>
  </div>
  
  <div class="sidebar-content">
    <div class="sidebar-header">
      <span>RSS</span>
    </div>
    <div id="rss">
      <a href="https://feng1st.github.io/index.xml" type="application/rss+xml" target="_blank">
        <i class="fa fa-rss-square fa-2x" aria-hidden="true"></i>
      </a>
    </div>
  </div>
</div>

      </div>
      <footer>
        <div id="site-footer-wrap">
          <div id="site-footer">
            <span>Powered by <a href="https://gohugo.io/">Hugo</a>.</span>
            <span>
              
              Copyright (c) 2017, <a href="https://feng1st.github.io/">知不足而后进</a>
              
            </span>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>

