<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content=' 协议分层  应用层 Application  对应OSI协议Application、Presentation、Session三层 常见上层协议：HTTP、FTP、SMTP、TELNET  传输层 Transport  对应OSI协议Transport层 协议：  TCP：（见下） UDP：不超时重传、不错误重传、不保证顺序   网络层 Internet  对应OSI协议Network层 协议：  IP：（见下） ARP：IP地址到MAC地址转换 DARP：（略） ICMP：发生错误时，错误信息封包传给主机；IP重定向报文；路由发现报文  ping traceroute  利用IP协议的TTL实现 利用主机不可达和端口不可达区分     网络接口层 Network Interface  对应OSI协议Data Link、Physical两层 附加以太网部首   IP协议  附加IP部首  TTL，生存周期，每路由一层减1，为0时丢弃  实现traceroute   路由顺序：  TTL为0时丢弃 匹配主机 匹配同子网路由器 匹配同网号路由器 匹配默认路由器  不保证可达，需配合ICMP由上层实现可靠性  TCP协议 流量控制的思想可以用于上层应用的开发
 附加TCP部首 可靠协议  合理分块 超时重发 校验和校验 发送确认 组装时排序 滑动窗口流控  建立连接，三次握手：    断开连接，四次握手：    流量控制  延迟发送  捎带ACK：延迟发送ACK Nagle算法：延迟发送数据  滑动窗口 rwnd：接收方缓冲区 拥塞窗口 cwnd：探测带宽上限  慢启动阶段（未超过门限 ssthresh）  cwnd *= 2  拥塞避免阶段（超过门限）  cwnd &#43;= 1    超时重传  超时时间调整：简单的说，是一个涉及旧超时时间、新传输时间、经验系数、方差的函数 拥塞：某报文超时需要重传  ssthresh /= 2 cwnd = 1 进入慢启动阶段  快速重传：当收到3个重复ACK时（=3个，丢包是大概率事件）  ssthresh /= 2 cwnd = ssthresh 进入拥塞避免阶段  快速恢复：（略）  其它计时器  坚持定时器：双方滑动窗口为0时的试探间隔，避免互相等待死锁 保活定时器：判断保持或断开半开放连接 2MSL定时器：端口可再次使用的计时器，在此期间，服务端可以重启而不报端口占用错误，但不可以建立连接   '>

<meta property='og:title' content='TCP/IP协议摘要 • 技术随笔'>
<meta property='og:description' content=' 协议分层  应用层 Application  对应OSI协议Application、Presentation、Session三层 常见上层协议：HTTP、FTP、SMTP、TELNET  传输层 Transport  对应OSI协议Transport层 协议：  TCP：（见下） UDP：不超时重传、不错误重传、不保证顺序   网络层 Internet  对应OSI协议Network层 协议：  IP：（见下） ARP：IP地址到MAC地址转换 DARP：（略） ICMP：发生错误时，错误信息封包传给主机；IP重定向报文；路由发现报文  ping traceroute  利用IP协议的TTL实现 利用主机不可达和端口不可达区分     网络接口层 Network Interface  对应OSI协议Data Link、Physical两层 附加以太网部首   IP协议  附加IP部首  TTL，生存周期，每路由一层减1，为0时丢弃  实现traceroute   路由顺序：  TTL为0时丢弃 匹配主机 匹配同子网路由器 匹配同网号路由器 匹配默认路由器  不保证可达，需配合ICMP由上层实现可靠性  TCP协议 流量控制的思想可以用于上层应用的开发
 附加TCP部首 可靠协议  合理分块 超时重发 校验和校验 发送确认 组装时排序 滑动窗口流控  建立连接，三次握手：    断开连接，四次握手：    流量控制  延迟发送  捎带ACK：延迟发送ACK Nagle算法：延迟发送数据  滑动窗口 rwnd：接收方缓冲区 拥塞窗口 cwnd：探测带宽上限  慢启动阶段（未超过门限 ssthresh）  cwnd *= 2  拥塞避免阶段（超过门限）  cwnd &#43;= 1    超时重传  超时时间调整：简单的说，是一个涉及旧超时时间、新传输时间、经验系数、方差的函数 拥塞：某报文超时需要重传  ssthresh /= 2 cwnd = 1 进入慢启动阶段  快速重传：当收到3个重复ACK时（=3个，丢包是大概率事件）  ssthresh /= 2 cwnd = ssthresh 进入拥塞避免阶段  快速恢复：（略）  其它计时器  坚持定时器：双方滑动窗口为0时的试探间隔，避免互相等待死锁 保活定时器：判断保持或断开半开放连接 2MSL定时器：端口可再次使用的计时器，在此期间，服务端可以重启而不报端口占用错误，但不可以建立连接   '>
<meta property='og:url' content='https://feng1st.github.io/post/2017/06/tcp-ip-protocol/'>
<meta property='og:site_name' content='技术随笔'>
<meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Network'><meta property='article:tag' content='TCP-IP'><meta property='article:published_time' content='2017-06-08T00:00:00Z'/><meta property='article:modified_time' content='2017-06-08T00:00:00Z'/>

<meta name="generator" content="Hugo 0.26" />

  <title>TCP/IP协议摘要 • 技术随笔</title>
  <link rel='canonical' href='https://feng1st.github.io/post/2017/06/tcp-ip-protocol/'>
  <link href='' rel='alternate' type='application/rss+xml' title='技术随笔' />
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Ubuntu:400,400i,700&subset=latin'>
<link rel='stylesheet' href='/css/main.d02777fd.css'>



</head>


<body class='page'>
  <div class='site'>
    <header id='header' class='header-container'>
      <div class='site-header'>
        <nav id='navmenu' aria-label='Main Menu'>
  <ul class='main-menu'>
    
    <li>
      <a href='/'>Home</a>
    </li>
    
    <li>
      <a href='/post/'>Posts</a>
    </li>
    
    <li>
      <a href='/categories/'>Categories</a>
    </li>
    
    <li>
      <a href='/tags/'>Tags</a>
    </li>
    
  </ul>
</nav>

        <div class='site-info'>
          
          <p class='site-title title'>技术随笔</p>
          
          <p class='site-description'></p>
        </div>
      </div>
    </header>


<main class='main'>
  <article lang='en' class='entry'>
    <header class='entry-header'>
  <div class='entry-info'>
    <h1 class='entry-title title'>TCP/IP协议摘要</h1>
    
  </div>
  
<div class='meta'>
  <span class='posted-on'>
    <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>

    <span class='screen-reader'>Posted on </span>
    <time class='date' datetime='2017-06-08T00:00:00Z'>2017, Jun 08</time>
  </span>
  
  
</div>


</header>

    <div class='entry-content'>
  

<h2 id="协议分层">协议分层</h2>

<ol>
<li>应用层 Application

<ul>
<li>对应OSI协议Application、Presentation、Session三层</li>
<li>常见上层协议：HTTP、FTP、SMTP、TELNET</li>
</ul></li>
<li>传输层 Transport

<ul>
<li>对应OSI协议Transport层</li>
<li>协议：

<ul>
<li>TCP：（见下）</li>
<li>UDP：不超时重传、不错误重传、不保证顺序</li>
</ul></li>
</ul></li>
<li>网络层 Internet

<ul>
<li>对应OSI协议Network层</li>
<li>协议：

<ul>
<li>IP：（见下）</li>
<li>ARP：IP地址到MAC地址转换</li>
<li>DARP：（略）</li>
<li>ICMP：发生错误时，错误信息封包传给主机；IP重定向报文；路由发现报文

<ul>
<li>ping</li>
<li>traceroute

<ul>
<li>利用IP协议的TTL实现</li>
<li>利用主机不可达和端口不可达区分</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li>网络接口层 Network Interface

<ul>
<li>对应OSI协议Data Link、Physical两层</li>
<li>附加以太网部首</li>
</ul></li>
</ol>

<h2 id="ip协议">IP协议</h2>

<ul>
<li>附加IP部首

<ul>
<li>TTL，生存周期，每路由一层减1，为0时丢弃

<ul>
<li>实现traceroute</li>
</ul></li>
</ul></li>
<li>路由顺序：

<ol>
<li>TTL为0时丢弃</li>
<li>匹配主机</li>
<li>匹配同子网路由器</li>
<li>匹配同网号路由器</li>
<li>匹配默认路由器</li>
</ol></li>
<li>不保证可达，需配合ICMP由上层实现可靠性</li>
</ul>

<h2 id="tcp协议">TCP协议</h2>

<p>流量控制的思想可以用于上层应用的开发</p>

<ul>
<li>附加TCP部首</li>
<li>可靠协议

<ol>
<li>合理分块</li>
<li>超时重发</li>
<li>校验和校验</li>
<li>发送确认</li>
<li>组装时排序</li>
<li>滑动窗口流控</li>
</ol></li>
<li>建立连接，三次握手：

<ul>
<li><img src="tcp-handshake-1.png" alt="" /></li>
</ul></li>
<li>断开连接，四次握手：

<ul>
<li><img src="tcp-handshake-2.png" alt="" /></li>
</ul></li>
<li>流量控制

<ul>
<li>延迟发送

<ul>
<li>捎带ACK：延迟发送ACK</li>
<li>Nagle算法：延迟发送数据</li>
</ul></li>
<li>滑动窗口 rwnd：接收方缓冲区</li>
<li>拥塞窗口 cwnd：探测带宽上限

<ul>
<li>慢启动阶段（未超过门限 ssthresh）

<ul>
<li><code>cwnd *= 2</code></li>
</ul></li>
<li>拥塞避免阶段（超过门限）

<ul>
<li><code>cwnd += 1</code></li>
</ul></li>
</ul></li>
</ul></li>
<li>超时重传

<ul>
<li>超时时间调整：简单的说，是一个涉及旧超时时间、新传输时间、经验系数、方差的函数</li>
<li>拥塞：某报文超时需要重传

<ul>
<li><code>ssthresh /= 2</code></li>
<li><code>cwnd = 1</code></li>
<li>进入慢启动阶段</li>
</ul></li>
<li>快速重传：当收到3个重复ACK时（<3个，乱序是大概率事件；>=3个，丢包是大概率事件）

<ul>
<li><code>ssthresh /= 2</code></li>
<li><code>cwnd = ssthresh</code></li>
<li>进入拥塞避免阶段</li>
</ul></li>
<li>快速恢复：（略）</li>
</ul></li>
<li>其它计时器

<ul>
<li>坚持定时器：双方滑动窗口为0时的试探间隔，避免互相等待死锁</li>
<li>保活定时器：判断保持或断开半开放连接</li>
<li>2MSL定时器：端口可再次使用的计时器，在此期间，服务端可以重启而不报端口占用错误，但不可以建立连接</li>
</ul></li>
</ul>

</div>

    
<footer class='entry-footer'>
  
    
      
      

<div class='categories'>
  <span class='category-icon'>
    <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M22,19a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V5A2,2,0,0,1,4,3H9l2,3h9a2,2,0,0,1,2,2Z"/>
  
</svg>

  </span>
  <span class='screen-reader'>Categories: </span><a class='category' href='/categories/network'>Network</a></div>

    
  
    
      
      

<div class='tags'>
  <span class='tag-icon'>
    <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>

  </span>
  <span class='screen-reader'>Tags: </span><a class='tag' href='/tags/network'>Network</a>, <a class='tag' href='/tags/tcp-ip'>TCP-IP</a></div>

    
  
</footer>


  </article>

  
    
<nav class='entry-nav'>
  <div class='entry-nav-links'><div class='prev-entry'>
      <a href='https://feng1st.github.io/post/2017/06/jvm-memory-gc/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader'>Previous post: </span>Java内存模型和GC机制摘要</a>
    </div><div class='next-entry'>
      <a href='https://feng1st.github.io/post/2017/06/http-protocol/'>
        <span class='screen-reader'>Next post: </span>HTTP协议摘要<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>


  

  
    <div class='comments-container'>
  
</div>

  
</main>

    <footer id='footer' class='footer-container'>
      <div class='footer'>
        <div class='social'>
  <nav aria-label='Social Menu'>
    <ul class='social-menu'></ul>
  </nav>
</div>

        <div class='copyright'>
          <p>
    
  
  &copy; 2017 feng1st</p>

        </div>
      </div>
    </footer>

  </div>

  <script src='/js/main.af838dd5.js'></script>
  

</body>

</html>

