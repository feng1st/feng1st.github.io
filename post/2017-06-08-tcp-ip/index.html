<!DOCTYPE html>
<html lang="utf-8">

<head>
    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.16-DEV" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="知耻而后勇，知不足而后进">
    <meta name="author" content="">

    <link rel="stylesheet" href="/css/bootstrap-3.3.7.min.css">
    <link rel="stylesheet" href="/css/theme.css">
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="/css/highlight-github-9.10.0.min.css">


    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://feng1st.github.io//index.xml">

    
    <title>TCP/IP协议摘要 - 知耻而后勇，知不足而后进</title>
    <meta property='og:title' content="TCP/IP协议摘要 - 知耻而后勇，知不足而后进">
    <meta property="og:type" content="article">
    

    <meta property="og:url" content="https://feng1st.github.io/post/2017-06-08-tcp-ip/">
    
    
</head>

<body>


    <div class="container">

      
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">知耻而后勇，知不足而后进</a>
          </div>
          
        </div>
      </nav>


<div class="row">
    <div class="col-lg-8">

        <article class="single well" itemscope="itemscope" itemtype="http://schema.org/Article">
            <meta itemprop="mainEntityOfPage"  itemType="https://schema.org/WebPage" content="https://feng1st.github.io/"/>
            <meta itemprop="dateModified" content="2017-06-08T00:00:00&#43;00:00">
            <meta itemprop="headline" content="TCP/IP协议摘要">
            <meta itemprop="description" content="协议分层 应用层 Application 对应OSI协议Application、Presentation、Session三层 常见上层协议：HTTP、FTP、SMTP、TELNET 传输层 Transport 对应OSI协议Transport层 协议： TCP：（见下） UDP：不超时重传、不错误重传、不保证顺序 网络层 Internet 对应OSI协议Network层 协议： IP：（见下） ARP：IP地址到MAC地址转换 DARP：（略） ICMP：发生错误时，错误信息封包传给主机；IP重定向报文；路由发现报文 ping traceroute 利用IP协议的TTL实现 利用主机不可达和端口不可达区分 网络接口层 Network Interface 对应OSI协议Data Link、Physical两层 附加以太网部首 IP协议 附加IP部首 TTL，生存周期，每路由一层减1，为0时丢弃 实现traceroute 路由顺序： TTL为0时丢弃 匹配主机 匹配同子网路由器 匹配同网号路由器 匹配默认路由器 不保证可达，需配合ICMP由上层实现可靠性 TCP协议 流量控制的思想可以用于上层应用的开发 附加TCP部首 可靠协议 合理分块 超时重发 校验和校验 发送确认 组装时排序 滑动窗口流控 建立连接，三次握手： Client-&gt;&gt;Server: SYN Server&ndash;&gt;&gt;Client: ACK Client&ndash;&gt;&gt;Server: ACK 断开连接，四次握手： Client-&gt;&gt;Server: FIN Server&ndash;&gt;&gt;Client: ACK Server-&gt;&gt;Client: FIN Client&ndash;&gt;&gt;Server: ACK 流量控制 延迟发送 捎带ACK：延迟发送ACK Nagle算法：延迟发送数据">
            <meta itemprop="url" content="https://feng1st.github.io/post/2017-06-08-tcp-ip/">
            <div itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
                <meta itemprop="url" content="https://feng1st.github.io/images/default.jpg" />
                <meta itemprop="width" content="800">
                <meta itemprop="height" content="800">
            </div>
            <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
                <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
                    <meta itemprop="url" content="https://feng1st.github.io/images/logo.jpg">
                    <meta itemprop="width" content="100">
                    <meta itemprop="height" content="100">
                </div>
                <meta itemprop="name" content="知耻而后勇，知不足而后进">
            </div>
            <div itemprop="author" itemscope itemtype="https://schema.org/Person">
                <meta itemprop="name" content="nf_xp">
            </div>
            <header class="article-header">
                <h1>TCP/IP协议摘要</h1>
                
                <time itemprop="datePublished" pubdate="pubdate" datetime="2017-06-08T00:00:00&#43;00:00"><i class="fa fa-clock-o"></i> Posted on June 8, 2017</time>
                
                
                
                <div class="section">
                    <i class="fa fa-folder-o"></i> <a href="https://feng1st.github.io//categories/network" class="tag">Network</a>
                </div>
                
                
                <div class="section">
                    <i class="fa fa-tag"></i> <a href="https://feng1st.github.io//tags/network" class="tag">Network</a>, <a href="https://feng1st.github.io//tags/tcp-ip" class="tag">TCP-IP</a>
                </div>
                
            </header>

            
            

<h2 id="协议分层:37348dd643956dbb1568c00c8cc0c5b2">协议分层</h2>

<ol>
<li>应用层 Application<br />

<ul>
<li>对应OSI协议Application、Presentation、Session三层<br /></li>
<li>常见上层协议：HTTP、FTP、SMTP、TELNET<br /></li>
</ul></li>
<li>传输层 Transport<br />

<ul>
<li>对应OSI协议Transport层<br /></li>
<li>协议：<br />

<ul>
<li>TCP：（见下）<br /></li>
<li>UDP：不超时重传、不错误重传、不保证顺序<br /></li>
</ul></li>
</ul></li>
<li>网络层 Internet<br />

<ul>
<li>对应OSI协议Network层<br /></li>
<li>协议：<br />

<ul>
<li>IP：（见下）<br /></li>
<li>ARP：IP地址到MAC地址转换<br /></li>
<li>DARP：（略）<br /></li>
<li>ICMP：发生错误时，错误信息封包传给主机；IP重定向报文；路由发现报文<br />

<ul>
<li>ping<br /></li>
<li>traceroute<br /></li>
<li>利用IP协议的TTL实现<br /></li>
<li>利用主机不可达和端口不可达区分<br /></li>
</ul></li>
</ul></li>
</ul></li>
<li>网络接口层 Network Interface<br />

<ul>
<li>对应OSI协议Data Link、Physical两层<br /></li>
<li>附加以太网部首<br /></li>
</ul></li>
</ol>

<h2 id="ip协议:37348dd643956dbb1568c00c8cc0c5b2">IP协议</h2>

<ul>
<li>附加IP部首<br />

<ul>
<li>TTL，生存周期，每路由一层减1，为0时丢弃<br />

<ul>
<li>实现traceroute<br /></li>
</ul></li>
</ul></li>
<li>路由顺序：<br />

<ol>
<li>TTL为0时丢弃<br /></li>
<li>匹配主机<br /></li>
<li>匹配同子网路由器<br /></li>
<li>匹配同网号路由器<br /></li>
<li>匹配默认路由器<br /></li>
</ol></li>
<li>不保证可达，需配合ICMP由上层实现可靠性<br /></li>
</ul>

<h2 id="tcp协议:37348dd643956dbb1568c00c8cc0c5b2">TCP协议</h2>

<p>流量控制的思想可以用于上层应用的开发</p>

<ul>
<li>附加TCP部首<br /></li>
<li>可靠协议<br />

<ol>
<li>合理分块<br /></li>
<li>超时重发<br /></li>
<li>校验和校验<br /></li>
<li>发送确认<br /></li>
<li>组装时排序<br /></li>
<li>滑动窗口流控<br /></li>
</ol></li>
<li>建立连接，三次握手：<br />

<ol>
<li>Client-&gt;&gt;Server: SYN<br /></li>
<li>Server&ndash;&gt;&gt;Client: ACK<br /></li>
<li>Client&ndash;&gt;&gt;Server: ACK<br /></li>
</ol></li>
<li>断开连接，四次握手：<br />

<ol>
<li>Client-&gt;&gt;Server: FIN<br /></li>
<li>Server&ndash;&gt;&gt;Client: ACK<br /></li>
<li>Server-&gt;&gt;Client: FIN<br /></li>
<li>Client&ndash;&gt;&gt;Server: ACK<br /></li>
</ol></li>
<li>流量控制<br />

<ul>
<li>延迟发送<br />

<ul>
<li>捎带ACK：延迟发送ACK<br /></li>
<li>Nagle算法：延迟发送数据<br /></li>
</ul></li>
<li>滑动窗口 rwnd：接收方缓冲区<br /></li>
<li>拥塞窗口 cwnd：探测带宽上限<br />

<ul>
<li>慢启动阶段（未超过门限 ssthresh）<br />

<ul>
<li><code>cwnd *= 2</code><br /></li>
</ul></li>
<li>拥塞避免阶段（超过门限）<br />

<ul>
<li><code>cwnd += 1</code><br /></li>
</ul></li>
</ul></li>
</ul></li>
<li>超时重传<br />

<ul>
<li>超时时间调整：简单的说，是一个涉及旧超时时间、新传输时间、经验系数、方差的函数<br /></li>
<li>拥塞：某报文超时需要重传<br />

<ul>
<li><code>ssthresh /= 2</code><br /></li>
<li><code>cwnd = 1</code><br /></li>
<li>进入慢启动阶段<br /></li>
</ul></li>
<li>快速重传：当收到3个重复ACK时（<3个，乱序是大概率事件；>=3个，丢包是大概率事件）<br />

<ul>
<li><code>ssthresh /= 2</code><br /></li>
<li><code>cwnd = ssthresh</code><br /></li>
<li>进入拥塞避免阶段<br /></li>
</ul></li>
<li>快速恢复：（略）<br /></li>
</ul></li>
<li>其它计时器<br />

<ul>
<li>坚持定时器：双方滑动窗口为0时的试探间隔，避免互相等待死锁<br /></li>
<li>保活定时器：判断保持或断开半开放连接<br /></li>
<li>2MSL定时器：端口可再次使用的计时器，在此期间，服务端可以重启而不报端口占用错误，但不可以建立连接<br /></li>
</ul></li>
</ul>


            <aside>
                
                
<div id="disqus_thread"></div>
<script>
    

    

    (function() {  
        var d = document, s = d.createElement('script');
        
        s.src = '//.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


            </aside>
        </article>

    </div>
    <aside class="col-md-4">

    

    

    
    
    <div class="well">
        <h3 class="text-capitalize">categories</h3>
        <ul class="list-unstyled">
        
            <li><a href="/categories/java">Java</a></li>
        
            <li><a href="/categories/network">Network</a></li>
        
        </ul>
    </div>
    
    
    
    <div class="well">
        <h3 class="text-capitalize">tags</h3>
        <ul class="list-unstyled">
        
            <li><a href="/tags/gc">GC</a></li>
        
            <li><a href="/tags/jvm">JVM</a></li>
        
            <li><a href="/tags/java">Java</a></li>
        
            <li><a href="/tags/network">Network</a></li>
        
            <li><a href="/tags/tcp-ip">TCP-IP</a></li>
        
        </ul>
    </div>
    
    

</aside>

</div>
            <footer>
                <div class="row">
                    <div class="col-lg-12">
                        <p>
                            <span id="copyright">&copy;</span>
                            
                                2017
                            
                            
                                <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC-BY-SA</a> -
                            
                                nf_xp
                                <br />
                            
                                Template by <a href="https://github.com/Fale/fale.io">fale.io</a> -
                            
                            
                                Theme by <a href="https://github.com/Fale/bootstrap2hugo">bootstrap2hugo</a> -
                            
                            Powered by <a href="http://gohugo.io" target="_blank">Hugo</a><br />
                        </p>
                    </div>
                </div>
            
            </footer>
        </div>

        <script src="/js/jquery-3.1.1.min.js"></script>
        <script src="/js/bootstrap-3.3.7.min.js"></script>
        <script type="text/javascript">
            (function() {
                var css = document.createElement('link');
                css.href = '/css/font-awesome-4.7.0.min.css';
                css.rel = 'stylesheet';
                css.type = 'text/css';
                document.getElementsByTagName('head')[0].appendChild(css);
            })();
        </script>
        <script src="/js/highlight-9.10.0.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

        <script>
(function() {
  if (window.location.hostname === "localhost") {
    console.log("Local dev, so no Google Analytics.");
    return;
  } else {
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', '', 'auto');
    ga('set', 'anonymizeIp', true);
    ga('send', 'pageview');
  }
})();
</script>

    </body>
</html>

